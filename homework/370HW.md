<p align="right">Yu xinmiao 于欣淼 518021910792</p>

##  VE370 Homework 1

### Q1

$$\begin{aligned}
\rm{\textbf{CPU Time}}
&= \frac{\rm{IC}\times \rm{CPI}}{\rm{Clock\ Rate}} = \frac{100000 \times 1.5}{500 \rm{MHz}} = \frac{IC_B \times 2.3}{850 \rm{MHz}}
\end{aligned}$$

Then from the equation, calculate that $IC_B \approx  110870$.



### Q2

$\begin{aligned}
\rm{\textbf{CPU Time}}
&= \frac{\rm{IC}\times \rm{CPI}}{\rm{Clock\ Rate}} = \frac{1100 \times 1 + (200+150)\times 7 + 120 \times 3}{2 \times 10^9} = 1.955 \times 10^{-6} \ [s]
\end{aligned}$

$\begin{aligned}
\rm{\textbf{CPI}}
&= \frac{\rm{CPU\ time}\times \rm{Clock\ Rate}}{IC} = \frac{1955\times 2}{1570} \approx  2.49 
\end{aligned}$



### Q3

1) $\begin{aligned}
\rm{\textbf{CPU Time}}
&= \frac{\rm{IC}\times \rm{CPI}}{\rm{Clock\ Rate}} = \frac{2560 \times 1 + (1280\times 4) + (256\times 2)}{3 \times 10^9} = 2.73 \times 10{^-6} \ [s]
\end{aligned}$

2) $\begin{aligned}
\rm{\textbf{CPU Time}}
&= \frac{1280 \times 1 + (640\times 6) + (128\times 2)}{3 \times 10^9} \approx 1.79 \times 10^{-6} \ [s]
\end{aligned}$

3) $\begin{aligned}
\rm{\textbf{CPU Time}}
&= \frac{640 \times 1 + (320\times 8) + (64\times 2)}{3 \times 10^9}\approx 1.11 \times 10^{-6} \ [s]
\end{aligned}$

4) $\begin{aligned}
\rm{\textbf{CPU Time}}
&= \frac{320 \times 1 + (160\times 10) + (32\times 2)}{24 \times 10^9} \approx 6.61 \times 10^{-7} \ [s]
\end{aligned}$



### Q4 

x = x - y + z -72

```assembly
add 	$t0, $s0, $s2		# $t0 = x + z
addi 	$t1, $s2, 72		# $t1 = y + 72
sub 	$s0, $t0, $t1		# $s0 = $t0 - $t1 
```



### Q5

B[8] = i + A[j]

```assembly
sll 	$t2, $t1, 2			# $t2 = $t1 * 4 = 4j
add 	$t2, $t2, $s5		# $t2 = address of A[j]
lw 		$t3, 0($t2)			# load from memory to register, $t3 = A[j]
add 	$t3, $t3, $t0		# $t3 = i + A[j] 
sw 		$t3, 32($s6)		# store the result from the register to memory 
```



### Q6

Assume `a, b, c, d`  in `$s0, $s1, $s2, $s3` respectively. The address of array A is 0x00000100, such that A[0] = 0x000011f0

```c
/*** Line by line ***/ 	// e:0x 
temp0 = &A[1]  				 	// temp0: 0x00000104  *temp0: 0x0000F1a4
temp1 = &A[0] 				 	// temp1: 0x00000100  *temp1: 0x000011f0
A[2] = temp1	 					// *0x00000108 = 0x00000100
temp0 = A[1] 			 			// temp0: 0x0000F1a4
a = temp0 + temp1 		 	// 0x0000F1a4 + 0x00000100
/***Simplify***/
a = A[1] + &A[0]
```

The value of \$s0 is 0x0000F2a4



### Q7

```assembly
lui 	$s0, 0x1000		# $s0 = 0x10000000
lb 		$s2, 2($s0)
```

In `$s2`  : 0x00000066



### Q8

```assembly
slt $t2, $t0, $t1 			# signed $t0 < $t1, so $t2 = 1
beq $t2, $0, ELSE 			# $t2 != 0, not branch to ELSE
j DONE 									# jump to done
ELSE: addi $t2, $0, -2 	# not executed 
DONE: ......
```

The value of `$t2` is 1.



### Q9

```assembly
positive:
    addi $sp, $sp, -12 	# adjust stack to make room for 3 items
    sw $ra, 8($sp)			# store the return address 
    sw $a1, 4($sp)			# store the function arguments 
    sw $a0, 0($sp)
    jal addit
    lw $a0, 0($sp)			# restore function arguments 
    lw $a1, 4($sp)
    lw $ra, 8($sp)			# restore return address 
    addi $sp, $sp, 12		# pop 3 items from stack 
    slt $v0, $zero, $v0	# if (0 < $v0), $v0 = 1; else $v0 = 0
    jr $ra
addit: 
    add $t0, $a0, $a1		# parameter variable a, b correspond to the argument register
    add $v0, $t0, $zero # copy into a return register
    jr $ra
```

![image-20200923185105542](/Users/yuxinmiao/Library/Application Support/typora-user-images/image-20200923185105542.png)



<div style="page-break-after: always; break-after: page;"></div> 

<p align="right">Yu xinmiao 于欣淼 518021910792</p>

# Homework 2

### Q1

refer to the figure 

```assembly
lui 	$s0, 0x0F00		# $s0 = 0x0F000000
lb 		$s1, 2($s0)
```

The content in \$s1 is 0x00000047

### Q2

```assembly
FACT: 
    addi $sp, $sp, -8 		## should be -8
    sw $ra, 4($sp)
    sw $a0, 0($sp) 
    ## add $s0, $0, $a0 should not store $a0 as $s0 and use $s0 after functio call
    slti $t0, $a0, 1 
    beq $t0, $0, L1
    addi $v0, $zero, 1
    # mul $v0, $s0, $v0 
    addi $sp, $sp, 8 
    jr $ra
L1: 
    addi $a0, $a0, -1 
    jal FACT
    # addi $v0, $0, 1 
    lw $a0, 4($sp)
    lw $ra, 0($sp) 
    addi $sp, $sp, 8 			## should be 8
    mul $v0, $a0, $v0
    jr $ra
```

### Q3

in binary, opcode and func, indicate the subtraction 

| opcode | rs         | rt         | rd         | shamt | funct         |
| ------ | ---------- | ---------- | ---------- | ----- | ------------- |
| 000000 | 01011 \$t3 | 11010 \$t2 | 01001  $t1 | 00000 | 100010 (0x22) |

1. ```assembly
   sub 	$t1, $t3, $t2
   ```

2. R-type

### Q4

`lw $s1, -32($s2)`

1. 1000 1110 0101 0001 1111 1111 1110 0000

| opcode | rs        | rt         | Immediate           |
| ------ | --------- | ---------- | ------------------- |
| 100011 | 10010 $s2 | 10001 \$s1 | 1111 1111 1110 0000 |

2. I-type

### Q5 ???

1. To represent the address of register, we need 7 bits ($2^7 = 128$). The bits needed for `opcode` and `funct` should not change. So **38 bits in total**. 

| opcode | rs     | rt     | rd     | shamt  | funct  |
| ------ | ------ | ------ | ------ | ------ | ------ |
| 6 bits | 7 bits | 7 bits | 7 bits | 5 bits | 6 bits |

2. **36 bits in total**

| opcode | rs     | rt     | Immediate |
| ------ | ------ | ------ | --------- |
| 6 bits | 7 bits | 7 bits | 16 bits   |

### Q6

1. For registers, 6 bits needed ($2^6 = 64$). `beq` is an I-type instruction

| opcode | rs     | rt     | Immediate |
| ------ | ------ | ------ | --------- |
| 6 bits | 6 bits | 6 bits | 14 bits   |

​	only 14 bits could be used to represent the relative address and calculate the target address. 

2. `jr` is a R-type instruciton. 

| opcode | rs     | rt     | rd     | shamt  | funct  |
| ------ | ------ | ------ | ------ | ------ | ------ |
| 6 bits | 6 bits | 6 bits | 6 bits | 5 bits | 3 bits |

​	As Pc = R[rs], the range of address do not be impacted. 

### Q7

```assembly
LOOP:
		slt  $t5, $zero, $t0
		bne  $t5, $zero, ELSE
		j    DONE
ELSE:
		addi $s3, $s3, 2
		addiu $t2, $t2, 1
DONE:
		j LOOP ...
```

Convert into machine code (binary)

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  overflow:hidden;padding:10px 5px;word-break:normal;}
.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg .tg-sotv{border-color:inherit;color:#706262;text-align:left;vertical-align:top}
.tg .tg-0pky{border-color:inherit;text-align:right;vertical-align:top}
</style>
<table class="tg">
<thead>
  <tr>
    <th class="tg-sotv">address <br></th>
    <th class="tg-0pky"></th>
    <th class="tg-0pky"></th>
    <th class="tg-0pky"></th>
    <th class="tg-0pky"></th>
    <th class="tg-0pky"></th>
    <th class="tg-0pky"></th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="tg-sotv"><span style="font-weight:normal;font-style:normal;text-decoration:none">0x1000F400 </span><span style="font-weight:bold;font-style:normal;text-decoration:none">LOOP:</span></td>
    <td class="tg-0pky">000000</td>
    <td class="tg-0pky">00000</td>
    <td class="tg-0pky">01000</td>
    <td class="tg-0pky">01101</td>
    <td class="tg-0pky">00000</td>
    <td class="tg-0pky">101010</td>
  </tr>
  <tr>
    <td class="tg-sotv">0x1000F404</td>
    <td class="tg-0pky">000101</td>
    <td class="tg-0pky"><span style="font-weight:normal;font-style:normal;text-decoration:none">01101</span></td>
    <td class="tg-0pky">00000</td>
    <td class="tg-0pky" colspan="3">0000 0000 0000 0001</td>
  </tr>
  <tr>
    <td class="tg-sotv">0x1000F408</td>
    <td class="tg-0pky">000010</td>
    <td class="tg-0pky" colspan="5">0000 0000 0000 1111 0100 1100 10</td>
  </tr>
  <tr>
    <td class="tg-sotv">0x1000F4c0 <span style="font-weight:bold">ELSE:</span></td>
    <td class="tg-0pky">001000</td>
    <td class="tg-0pky">10011</td>
    <td class="tg-0pky">10011</td>
    <td class="tg-0pky" colspan="3">0000 0000 0000 0010</td>
  </tr>
  <tr>
    <td class="tg-sotv">0x1000F4c4</td>
    <td class="tg-0pky">001001</td>
    <td class="tg-0pky">01001</td>
    <td class="tg-0pky">01001</td>
    <td class="tg-0pky" colspan="3">0000 0000 0000 0001</td>
  </tr>
  <tr>
    <td class="tg-sotv">0x1000F4c8 <span style="font-weight:bold">DONE:</span></td>
    <td class="tg-0pky">000010</td>
    <td class="tg-0pky" colspan="5">0000 0000 0000 1111 0100 0000 00</td>
  </tr>
</tbody>
</table>

### Q8



### Q9





### Q10

- In procedure A, `lui` is load the address of `X` ; `jr` need to jump to the address in the register `$ra` 

- In procedure B, with the 2’s complement, 0x10008000(\$gp) + 0x8040(offset) = 0x10000040(Y).

  because address `0` in B means 0x00400140, then the address `0x180` is 0x00400140+0x180= 0x004002c0. Then when  `jal (address of A)` in B, `$ra ` stores the $PC+4$, which is 0x004002c4



<style type="text/css">
.tg  {border-collapse:collapse;border-color:#ccc;border-spacing:0;}
.tg td{background-color:#fff;border-color:#ccc;border-style:solid;border-width:1px;color:#333;
  font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg th{background-color:#f0f0f0;border-color:#ccc;border-style:solid;border-width:1px;color:#333;
  font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-0lax{text-align:left;vertical-align:top}
.tg .tg-73oq{border-color:#000000;text-align:left;vertical-align:top}
</style>
<table class="tg">
<thead>
  <tr>
    <th class="tg-0pky">Executable file header</th>
    <th class="tg-0pky"></th>
    <th class="tg-0pky"></th>
    <th class="tg-0lax"></th>
  </tr>
</thead>
<tbody>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">Text size</td>
    <td class="tg-0pky">0x440</td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">Data size</td>
    <td class="tg-0pky">0x90</td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-0pky"><span style="font-weight:bold">Text segment</span></td>
    <td class="tg-0pky">Address</td>
    <td class="tg-0pky">Instruction</td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">0x0040 0000</td>
    <td class="tg-0pky">lui&nbsp;&nbsp;$at, 0x1000</td>
    <td class="tg-0lax">001111 00000 00001 0001000000000000</td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">0x0040 0004</td>
    <td class="tg-0pky">ori&nbsp;&nbsp;$a0, $at, 0x1000</td>
    <td class="tg-0lax">001101 00001 00100 0001000000000000</td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">...</td>
    <td class="tg-0pky"></td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">0x0040 0084</td>
    <td class="tg-0pky">jmp  0x040 02c4</td>
    <td class="tg-73oq">(jr)   000000 11111 00000 00000 00000 001000<br>(j) 000011 </td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">...</td>
    <td class="tg-0pky"></td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">0x0040 0140</td>
    <td class="tg-0pky">sw&nbsp;&nbsp;$a0, 8040($gp)</td>
    <td class="tg-0lax">101011 11100 00100 1000 0000 0100 0000</td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">0x0040 0144</td>
    <td class="tg-0pky">jmp 0x040 02c0</td>
    <td class="tg-0lax">000010 0000 0100 0000 0000 0010 1100 00</td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">...</td>
    <td class="tg-0pky"></td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">0x0040 02c0</td>
    <td class="tg-0pky">jal 0x0400000</td>
    <td class="tg-0lax">000011 0000 0100 0000 0000 0000 0000 00</td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">...</td>
    <td class="tg-0pky">...</td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-0pky"><span style="font-weight:bold">Data segment</span></td>
    <td class="tg-0pky">Address</td>
    <td class="tg-0pky"></td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky"><span style="font-weight:400;font-style:normal">0x1000 0000</span></td>
    <td class="tg-0pky">(X)</td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">...</td>
    <td class="tg-0pky">...</td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-0pky"></td>
    <td class="tg-0pky">0x1000 0040</td>
    <td class="tg-0pky">(Y)</td>
    <td class="tg-0lax"></td>
  </tr>
</tbody>
</table>

